Cảm ơn bạn. Kế hoạch của tôi:

Map luồng định tuyến và cấu trúc chính
Audit bảo mật đăng nhập, phiên và CSRF
Quét model để kiểm tra truy vấn SQL (PDO/prepare)
Rà view xem thoát HTML và chèn CSRF
Nêu các tính năng còn thiếu
Đề xuất nâng cấp kiến trúc và DevOps
Tiến độ: Tôi đã rà soát luồng, models, và views; đang audit bảo mật auth/session. Dưới đây là đánh giá và đề xuất cụ thể.

Tổng Quan

Kiến trúc hiện tại là MVC đơn giản, entry tại index.php, autoload và PDO ở Database.php, router cơ bản ở Router.php song song với cơ chế page= để include view.
Auth khách hàng và nhân viên đã dùng password_hash()/password_verify(), có bước rehash khi phát hiện mật khẩu plaintext trong DB, và có CSRF token sinh/kiểm ở helpers.php.
Models phần lớn dùng PDO::prepare() với tham số, tốt cho chống SQLi. Views sử dụng htmlspecialchars() khá nhất quán.
Điểm Tốt

Bảo mật mật khẩu: password_hash() + password_verify() và tự động nâng cấp hash khi cần ở AuthController.php và EmployeeAuthController.php.
CSRF: Sinh/kiểm tra token qua generate_csrf_token()/verify_csrf_token() và ép kiểm tra bằng require_csrf_or_redirect() ở controllers hành động.
SQL: Hầu hết queries qua prepare + execute (ví dụ customer.php, product.php).
Upload ảnh: Có kiểm tra mime/extension, kích thước, tên file có định danh sản phẩm ở EmployeeActionController.php.
Vấn Đề/Nhược Điểm Nhỏ

Định tuyến kép: Vừa có Router, vừa render theo page= trong index.php. Nên thống nhất một cơ chế (ưu tiên Router + controllers).
getAllProducts() ở product.php:31-61: dùng $pdo->query($sql) rồi lại $stmt->execute() là thừa; query() đã thực thi. Nên dùng prepare()->execute() hoặc chỉ query() rồi fetchAll().
Cấu hình DB nằm trong source config.php. Nên chuyển sang .env/biến môi trường, tránh lộ secrets. Có block prod sample bị comment — nhưng vẫn là hard-code trong repo.
Upload ảnh nằm dưới products. Cân nhắc đặt ngoài webroot/đổi tên ngẫu nhiên + kiểm soát truy cập, hoặc dùng CDN; hiện tại tên file dự đoán được.
Một số filter/sort thực hiện bằng PHP array_filter/usort sau khi lấy toàn bộ dữ liệu (ví dụ filterProducts()), dễ chậm với dataset lớn; nên chuyển sang truy vấn SQL có điều kiện + phân trang.
Phiên: Có session_regenerate_id(true) khi login, nhưng chưa thấy bật cookie flags (SameSite/HttpOnly/Secure) hay cấu hình session save path — nên bổ sung.
API: Đã có endpoints cơ bản (products/providers/publishers/customers/employees) nhưng chưa thấy rate limit thực thi dù có config api_rate_limit. CORS '*' trong config.php cần cân nhắc.
Tính Năng Còn Thiếu/Nên Cải Tiến

Tài khoản khách:
Đổi mật khẩu trong trang tài khoản; xác thực email; khóa/mở khóa phiên; đăng nhập đa bước (2FA tùy chọn).
Lịch sử đăng nhập chi tiết + email cảnh báo truy cập lạ (đã có notification, có thể mở rộng).
Tìm kiếm/sản phẩm:
Tìm kiếm full-text theo tên/tác giả/nhà xuất bản; bộ lọc nâng cao (giá, thể loại, nhà cung cấp, NXB) chạy bằng SQL có index + phân trang ở UI.
Gợi ý sản phẩm liên quan; đề xuất theo lượt xem/mua; top sellers theo kỳ.
Giỏ hàng/Thanh toán:
Tích hợp cổng thanh toán (MoMo/ZaloPay/VNPay) với trạng thái thanh toán; tính phí vận chuyển, mã giảm giá/coupon; lưu địa chỉ nhiều nơi và mặc định (model addresses đã có nền tảng).
Đơn hàng:
Tracking trạng thái chi tiết + timeline; hủy/đổi trả; xuất hóa đơn PDF (đã có Mpdf, có thể gắn vào OrdersModel).
Yêu thích/Đánh giá:
Chống spamreview, moderation; vote hữu ích; ảnh trong review (upload kiểm soát).
Khuyến mãi:
Lịch áp dụng, điều kiện (đơn tối thiểu, theo category/provider), mã coupon; trang landing khuyến mãi.
Admin/Employee:
Báo cáo doanh thu theo thời gian, tồn kho cảnh báo; xuất XLSX (đã có SimpleXLSXGen, cần hook vào reports).
Phân quyền chi tiết theo chức năng (not just page); nhật ký hoạt động (audit log).
API:
Chuẩn hóa endpoints RESTful, dùng token (JWT)/session; áp dụng rate limit từ config; CORS whitelist; tài liệu Swagger/OpenAPI.
Bảo Mật & Hiệu Năng

Cookie/Session:
Thiết lập cookie params: httponly, secure (trên HTTPS), samesite=Lax/Strict, thời hạn hợp lý, và session.use_strict_mode = 1.
CSRF đã tốt; thêm Content-Security-Policy, X-Frame-Options, X-Content-Type-Options, Referrer-Policy ở layer bootstrap.
Upload:
Lưu file với tên ngẫu nhiên (UUID), kiểm virus nếu có thể, và loại bỏ EXIF.
DB:
Thêm index cho cột lọc/tìm kiếm; chuyển filter/sort sang SQL; tránh UNION lớn nếu có thể tối ưu bằng view/materialized table.
Caching:
Dùng cache (Redis/APCu) cho danh mục/nhà cung cấp/NXB; paginate products với count cache.
Kiến Trúc/DevOps

Composer + PSR-4 autoload: Chuẩn hóa autoload thay vì include thủ công ở index.php, gom namespace cho Controllers, Models, Core.
Cấu hình .env:
Tạo dotenv (vlucas/phpdotenv), đọc DB/CORS/API limits từ env; tách cấu hình dev/prod.
Test/CI:
Thêm PHPUnit test cơ bản cho models/controllers; GitHub Actions chạy lint + test.
Docker:
Compose (PHP-FPM + Nginx + MySQL) để dev đồng nhất; script seed dữ liệu mẫu.
Logging/Monitoring:
Monolog thay error_log, chuẩn hóa logger + channel, viết file/rotate và gửi về hệ thống tập trung.
Sửa Nhanh Đề Xuất

Sửa getAllProducts() ở product.php:31-61 bỏ execute() thừa:
Dùng prepare($sql); execute(); fetchAll(); hoặc query($sql); fetchAll();.
Thêm middleware session/cookie flags (bootstrap đoạn đầu index.php):
session_set_cookie_params([... 'httponly'=>true, 'samesite'=>'Lax', 'secure'=>true]) trước session_start(); kiểm tra môi trường HTTPS.
Thống nhất routing: Dần di chuyển logic page sang Router + controllers để dễ kiểm soát quyền/CSRF/tách concern.
Bật áp dụng api_rate_limit trong ApiController cho endpoints công khai; siết api_allowed_origins.
Bạn muốn tôi bắt đầu với:

Áp dụng .env + phpdotenv và chuyển config.php sang đọc env?
Sửa getAllProducts() và thêm phân trang/server-side filter ở ProductModel?
Thêm session cookie flags và CSP headers ở bootstrap index.php?
Tôi có thể triển khai từng bước, chạy kiểm tra nhanh và báo lại kết quả.

